{% extends "base.html" %}

{% block title %}Teacher Report - {{ teacher.full_name }} - Raindrops Academy{% endblock %}

{% block content %}
<section class="admin-section">
    <div class="container">
        <div class="admin-header">
            <h1>Teacher Report: {{ teacher.full_name }}</h1>
            <p>Student matrix and performance overview</p>
            <a href="{{ url_for('admin_teachers') }}" class="btn btn-secondary">‚Üê Back to Teachers</a>
        </div>

        <!-- Teacher Info Card -->
        <div class="info-card">
            <h3>Teacher Information</h3>
            <div class="info-grid">
                <div class="info-item">
                    <strong>Name:</strong> {{ teacher.full_name }}
                </div>
                <div class="info-item">
                    <strong>Email:</strong> {{ teacher.email }}
                </div>
                <div class="info-item">
                    <strong>Phone:</strong> {{ teacher.phone or 'N/A' }}
                </div>
                <div class="info-item">
                    <strong>Username:</strong> {{ teacher.username }}
                </div>
            </div>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üìö</div>
                <div class="stat-info">
                    <h3>{{ courses|length }}</h3>
                    <p>Assigned Courses</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üë®‚Äçüéì</div>
                <div class="stat-info">
                    <h3>{{ total_students }}</h3>
                    <p>Total Students</p>
                </div>
            </div>
            <div class="stat-card stat-danger">
                <div class="stat-icon">‚ö†Ô∏è</div>
                <div class="stat-info">
                    <h3>{{ overdue_count }}</h3>
                    <p>Overdue Payments</p>
                </div>
            </div>
            <div class="stat-card stat-success">
                <div class="stat-icon">üí∞</div>
                <div class="stat-info">
                    <h3>${{ "%.2f"|format(total_revenue) }}</h3>
                    <p>Total Revenue</p>
                </div>
            </div>
        </div>

        <!-- Assigned Courses -->
        <div class="admin-section-header">
            <h2>Assigned Courses</h2>
        </div>

        {% if courses %}
        <div class="courses-grid">
            {% for course in courses %}
            <div class="course-card">
                {% if course.icon %}
                <img src="{{ course.icon }}" alt="{{ course.name }}" class="course-image">
                {% endif %}
                <div class="course-info">
                    <h3>{{ course.name }}</h3>
                    <p class="course-duration">{{ course.duration }}</p>
                    <p class="course-fee">${{ "%.2f"|format(course.tuition_fee) }}/month</p>
                    <p class="enrolled-count">
                        {{ course.enrollments|length }} student(s) enrolled
                    </p>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <p>No courses assigned to this teacher yet.</p>
        </div>
        {% endif %}

        <!-- Student Matrix -->
        <div class="admin-section-header">
            <h2>Student Payment Matrix</h2>
        </div>

        {% if student_data %}
        <div class="table-container">
            <table class="reports-table">
                <thead>
                    <tr>
                        <th>Student Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Course</th>
                        <th>Enrollment Date</th>
                        <th>Last Payment</th>
                        <th>Next Due Date</th>
                        <th>Payment Status</th>
                        <th>Monthly Fee</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in student_data %}
                    <tr class="status-{{ item.status_class }}">
                        <td>{{ item.student.full_name }}</td>
                        <td>{{ item.student.email }}</td>
                        <td>{{ item.student.phone or 'N/A' }}</td>
                        <td>{{ item.course.name }}</td>
                        <td>{{ item.enrollment.enrollment_date.strftime('%b %d, %Y') }}</td>
                        <td>
                            {% if item.enrollment.last_payment_date %}
                                {{ item.enrollment.last_payment_date.strftime('%b %d, %Y') }}
                            {% else %}
                                <span class="badge badge-warning">No payment yet</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if item.enrollment.next_payment_due %}
                                {{ item.enrollment.next_payment_due.strftime('%b %d, %Y') }}
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td>
                            <span class="badge badge-{{ item.status_class }}">
                                {{ item.payment_status }}
                            </span>
                        </td>
                        <td>${{ "%.2f"|format(item.course.tuition_fee) }}</td>
                        <td>
                            <form method="POST" action="{{ url_for('send_payment_reminder', enrollment_id=item.enrollment.id) }}" style="display: inline;">
                                <button type="submit" class="btn btn-sm btn-warning" title="Send Payment Reminder">
                                    üìß Remind
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <p>No students enrolled in this teacher's courses yet.</p>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}
